import{r as a,a as u,j as r}from"./jsx-runtime.91c62a54.js";const h="f71910da-e7e2-4deb-b99f-cc00eeddb1d0",m="3ac5c167-6c44-42f2-a1f2-57990185ae5e",f=chrome.identity.getRedirectURL(),g="https://orga6a657bc.crm.dynamics.com/.default openid profile offline_access",E=`https://login.microsoftonline.com/${m}/oauth2/v2.0/authorize?client_id=${h}&response_type=token&response_mode=fragment&redirect_uri=${encodeURIComponent(f)}&scope=${encodeURIComponent(g)}&prompt=select_account`;async function w(){return new Promise((t,n)=>{chrome.identity.launchWebAuthFlow({url:E,interactive:!0},async e=>{if(chrome.runtime.lastError||!e){console.error("Login failed:",chrome.runtime.lastError),n(new Error("Failed to authenticate"));return}const o=new URLSearchParams(new URL(e).hash.substring(1)).get("access_token");if(!o){n(new Error("No access token received"));return}console.log("Received access token:",o),chrome.storage.local.set({accessToken:o},()=>{console.log("Access token stored successfully"),t(o)})})})}async function k(){return new Promise((t,n)=>{chrome.storage.local.get(["accessToken"],e=>{e.accessToken?t(e.accessToken):n(new Error("No access token found"))})})}const y="https://orga6a657bc.crm.dynamics.com/api/data/v9.0/opportunities?$top=5",R=()=>{const[t,n]=a.exports.useState(null),[e,i]=a.exports.useState(!1),[o,d]=a.exports.useState(null);return a.exports.useEffect(()=>{async function s(){i(!0);try{const c=await k();if(!c)throw new Error("No access token available");const l=await fetch(y,{method:"GET",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(!l.ok)throw new Error(`API request failed: ${l.statusText}`);const p=await l.json();n(p.value)}catch(c){d(c.message)}finally{i(!1)}}s()},[]),u("div",{children:[r("h2",{children:"NordSales Extension"}),r("button",{onClick:w,children:"Sign in with Microsoft"}),e&&r("p",{children:"Loading opportunities..."}),o&&u("p",{style:{color:"red"},children:["Error: ",o]}),t&&r("ul",{children:t.map(s=>r("li",{children:s.name},s.opportunityid))})]})};export{R as P};
