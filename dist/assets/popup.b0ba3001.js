import{r as a,a as u,j as c,F as h}from"./jsx-runtime.6b0a9898.js";const g="f71910da-e7e2-4deb-b99f-cc00eeddb1d0",m="3ac5c167-6c44-42f2-a1f2-57990185ae5e",f=chrome.identity.getRedirectURL(),k="https://orga6a657bc.crm.dynamics.com/.default openid profile offline_access",y=`https://login.microsoftonline.com/${m}/oauth2/v2.0/authorize?client_id=${g}&response_type=token&response_mode=fragment&redirect_uri=${encodeURIComponent(f)}&scope=${encodeURIComponent(k)}&prompt=select_account`;async function w(){return new Promise((t,n)=>{chrome.identity.launchWebAuthFlow({url:y,interactive:!0},async r=>{if(chrome.runtime.lastError||!r){console.error("Login failed:",chrome.runtime.lastError),n(new Error("Failed to authenticate"));return}const s=new URLSearchParams(new URL(r).hash.substring(1)).get("access_token");if(!s){n(new Error("No access token received"));return}console.log("Received access token:",s),chrome.storage.local.set({accessToken:s},()=>{console.log("Access token stored successfully"),t(s)})})})}async function b(){return new Promise((t,n)=>{chrome.storage.local.get(["accessToken"],r=>{r.accessToken?t(r.accessToken):n(new Error("No access token found"))})})}async function L(){return new Promise(t=>{chrome.storage.local.remove(["accessToken"],()=>{console.log("User logged out"),t()})})}const x="https://orga6a657bc.crm.dynamics.com/api/data/v9.0/opportunities?$top=5",_=()=>{const[t,n]=a.exports.useState(null),[r,i]=a.exports.useState([]),[s,l]=a.exports.useState(!1),d=async e=>{try{l(!0);const o=await fetch(x,{headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new Error("Failed to fetch data");const p=await o.json();i(p.value)}catch(o){console.error("Error fetching opportunities:",o)}finally{l(!1)}};return a.exports.useEffect(()=>{async function e(){try{const o=await b();n(o),o&&d(o)}catch{console.warn("No stored access token found")}}e()},[]),u("div",{style:{padding:"10px",width:"250px"},children:[c("h2",{children:c("b",{children:"NordSales Extension"})}),!t&&c("button",{onClick:async()=>{try{const e=await w();n(e),d(e)}catch(e){console.error("Login failed:",e)}},style:{padding:"10px",background:"black",color:"white",border:"none",cursor:"pointer",marginBottom:"10px"},children:"Sign in with Microsoft"}),t&&u(h,{children:[c("button",{onClick:async()=>{await L(),n(null),i([])},style:{padding:"10px",background:"red",color:"white",border:"none",cursor:"pointer",marginBottom:"10px"},children:"Logout"}),s?c("p",{children:"Loading opportunities..."}):c("ul",{children:r.map(e=>c("li",{children:e.name},e.opportunityid))})]})]})};export{_ as P};
